<div class="network-container">

  <svg class="network-svg" viewBox="0 0 1000 400">
    <!-- Define reusable arrow markers -->
    <defs>
      <!-- Standard arrow for base connection					<div class="endpoint-simple-log">
					<svg class="doc-icon" width="11" height="15" viewBox="0 0 11 15" fill="none" xmlns="http://www.w3.org/2000/svg">
						<path d="M6.75 5.19H3M8 7.69H3M6.125 10.19H3M0.5 1.44V13.94L1.75 13.315L3 13.94L4.25 13.315L5.5 13.94L6.75 13.315L8 13.94L9.25 13.315L10.5 13.94V1.44L9.25 2.065L8 1.44L6.75 2.065L5.5 1.44L4.25 2.065L3 1.44L1.75 2.065L0.5 1.44Z" stroke="#858D9D" stroke-width="0.9375" stroke-linecap="round" stroke-linejoin="round"/>
					</svg>
					<span class="endpoint-simple-label-strong">Lorem:</span>
					<span class="endpoint-simple-highlight">Lorem "Ipsum"</span>
				</div>
				<div class="endpoint-simple-footer">
					<span class="endpoint-simple-label-strong">Loremipsum</span>
					<span class="endpoint-simple-pill">{{ hoveredNode.metadata?.code }}</span>
				</div>g-container>
	</div>
</div>	<marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="2.5" orient="auto" markerUnits="strokeWidth">
				<path d="M0,0 L0,5 L10,2.5 z" fill="#858D9D"/>
			</marker>
			<!-- Fork arrows -->
      <marker id="fork-arrow" markerWidth="12" markerHeight="12" refX="10" refY="3" orient="auto"
        markerUnits="strokeWidth">
        <path d="M0,0 L0,6 L12,3 z" fill="#858D9D" />
      </marker>
    </defs>

    <!-- Connection Lines -->
    <g class="connections">
      <!-- Straight connections with arrows -->
      <ng-container *ngFor="let connection of baseConnections">
        <line [attr.x1]="getNodePosition(connection.from).x + getDefaultRadius()"
          [attr.y1]="getNodePosition(connection.from).y"
          [attr.x2]="getNodePosition(connection.to).x - getDefaultRadius()" [attr.y2]="getNodePosition(connection.to).y"
          stroke="#858D9D" stroke-width="1" class="connection-line" stroke-linecap="round" marker-end="url(#arrow)" />
      </ng-container>

      <!-- Exact SVG Fork replication -->
      <g *ngIf="fork && useExactFork" [attr.transform]="forkExactTransform" class="exact-fork" fill="none"
        stroke="#858D9D" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
        <!-- Handle behind fork -->
        <path [attr.d]="forkHandlePath" />
        <!-- Shortened teeth (15% reduction): scale original arrowhead x by 0.85 around its base -->
        <g transform="translate(176,0) scale(0.85,1) translate(-176,0)">
          <path
            d="M208 2.56104L204.25 4.7261L204.25 0.395972L208 2.56104ZM80.8318 55.936L0 55.936L0 55.186L80.8318 55.186L80.8318 55.936ZM204.625 2.93604L144.795 2.93603L144.795 2.18603L204.625 2.18604L204.625 2.93604ZM127.503 11.2585L98.7098 47.3314L98.1236 46.8635L126.917 10.7907L127.503 11.2585ZM144.795 2.93603C138.066 2.93603 131.702 5.99895 127.503 11.2585L126.917 10.7907C131.258 5.35277 137.837 2.18603 144.795 2.18603L144.795 2.93603ZM80.8318 55.186C87.5615 55.186 93.9254 52.1231 98.1236 46.8635L98.7098 47.3314C94.3692 52.7693 87.7896 55.936 80.8318 55.936L80.8318 55.186Z" />
          <path
            d="M208 107.279L204.25 105.114L204.25 109.444L208 107.279ZM80.9605 54.9038L0 54.9038L0 55.6538L80.9605 55.6538L80.9605 54.9038ZM204.625 106.904L144.667 106.904L144.667 107.654L204.625 107.654L204.625 106.904ZM127.504 98.7416L98.7049 63.3427L98.1231 63.816L126.922 99.2149L127.504 98.7416ZM144.667 106.904C138.009 106.904 131.705 103.906 127.504 98.7416L126.922 99.2149C131.266 104.554 137.783 107.654 144.667 107.654L144.667 106.904ZM80.9605 55.6538C87.618 55.6538 93.9216 58.6517 98.1231 63.816L98.7049 63.3427C94.361 58.0033 87.8437 54.9038 80.9605 54.9038L80.9605 55.6538Z" />
        </g>
      </g>
      <!-- Dynamic fork fallback -->
      <ng-container *ngIf="fork && !useExactFork">
        <path [attr.d]="forkPath" stroke="#858D9D" stroke-width="1" fill="none" stroke-linecap="round"
          class="connection-line fork-trunk" />
        <path [attr.d]="upperBranchPath" stroke="#858D9D" stroke-width="1" fill="none" stroke-linecap="round"
          class="connection-line fork-branch" marker-end="url(#fork-arrow)" />
        <path [attr.d]="lowerBranchPath" stroke="#858D9D" stroke-width="1" fill="none" stroke-linecap="round"
          class="connection-line fork-branch" marker-end="url(#fork-arrow)" />
      </ng-container>
    </g>

    <!-- Network Nodes -->
    <g class="nodes">
      <g *ngFor="let node of nodes" [attr.transform]="'translate(' + node.position.x + ',' + node.position.y + ')'"
        class="node-group" (mouseenter)="onNodeEnter(node)" (mouseleave)="onNodeLeave()">
        <!-- Node Image - 52.92px exact dimensions -->
        <image [attr.href]="getNodeIcon(node)" [attr.xlink:href]="getNodeIcon(node)" [attr.x]="-getNodeImageSize()/2"
          [attr.y]="-getNodeImageSize()/2" [attr.width]="getNodeImageSize()" [attr.height]="getNodeImageSize()"
          preserveAspectRatio="xMidYMid meet"></image>

        <!-- Node Label -->
        <text [attr.y]="getNodeImageSize()/2 + 20" text-anchor="middle" class="node-label" fill="#374151"
          font-family="system-ui, -apple-system, sans-serif" font-size="16" font-weight="600">{{ node.label }}</text>

        <!-- IP Address (if available) -->
        <text *ngIf="node.metadata?.ip" [attr.y]="getNodeImageSize()/2 + 38" text-anchor="middle" class="node-ip"
          fill="#6b7280" font-family="system-ui, -apple-system, sans-serif" font-size="13">{{ node.metadata?.ip
          }}</text>
      </g>
    </g>
  </svg>

  <!-- Hover Tooltip/Component -->
  <div *ngIf="hoveredNode" class="node-tooltip" [ngClass]="{'user-tooltip': hoveredNode.id==='user'}"
    [style.left.px]="tooltipPosition.x" [style.top.px]="tooltipPosition.y">
    <!-- Variant Popovers -->
    <ng-container [ngSwitch]="hoveredNode.id">
      <!-- 1. User variant (compact redesign) -->
      <div *ngSwitchCase="'user'" class="popover popover-user user-compact">
        <div class="user-compact-title">{{ hoveredNode.metadata?.titleBar || (hoveredNode.label | titlecase) }}</div>
        <div class="user-compact-grid space-left">
          <ng-container *ngFor="let p of (hoveredNode.metadata?.pills1 || []); let i = index">
            <span class="user-compact-pill">{{p}}</span>
          </ng-container>
          <ng-container *ngFor="let p of (hoveredNode.metadata?.pills2 || []); let i = index">
            <span class="user-compact-pill">{{p}}</span>
          </ng-container>
        </div>
        <div class="user-compact-footer" *ngIf="hoveredNode.metadata?.code">{{ hoveredNode.metadata?.code }}</div>
      </div>

      <!-- 2. Server1 variant (design 2) -->
      <div *ngSwitchCase="'server1'" class="popover popover-server">
        <div class="node-row">
          <div class="icon-col">
            <img src="assets/icons/status/stack-bars.svg" class="inline-node-icon" alt="server" />
          </div>
          <div class="header-text">
            <div class="label-strong">{{ hoveredNode.label }}</div>
          </div>
        </div>
        <div class="section">
          <div class="line">
            <svg width="11" height="15" viewBox="0 0 11 15" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M6.75 5.19H3M8 7.69H3M6.125 10.19H3M0.5 1.44V13.94L1.75 13.315L3 13.94L4.25 13.315L5.5 13.94L6.75 13.315L8 13.94L9.25 13.315L10.5 13.94V1.44L9.25 2.065L8 1.44L6.75 2.065L5.5 1.44L4.25 2.065L3 1.44L1.75 2.065L0.5 1.44Z"
                stroke="#858D9D" stroke-width="0.9375" stroke-linecap="round" stroke-linejoin="round" />
            </svg>

            <span class="label-strong">Lorem:</span> <span class="label-strong">Loremipsum Loremipsum</span> <span
              class="pill pill-purple align-right" *ngIf="hoveredNode.metadata?.code">{{ hoveredNode.metadata?.code
              }}</span>
          </div>
          <div class="pill-row">
            <span *ngFor="let p of hoveredNode.metadata?.pills1" class="pill pill-purple">{{p}}</span>
            <span class="label-strong">Loremipsum</span>
            <span *ngFor="let p of hoveredNode.metadata?.pills2" class="pill pill-purple">{{p}}</span>
          </div>
        </div>
      </div>

      <!-- 3. Server2 variant (compact redesign) -->
      <div *ngSwitchCase="'server2'" class="popover popover-server2-compact">
        <div class="s2-header">
          <img src="assets/icons/status/stack-bars.svg" class="s2-icon" alt="server" />
          <div class="s2-label">{{ hoveredNode.label }}</div>
        </div>
        <div class="s2-log">
          <svg class="doc-icon small" width="11" height="15" viewBox="0 0 11 15" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path
              d="M6.75 5.19H3M8 7.69H3M6.125 10.19H3M0.5 1.44V13.94L1.75 13.315L3 13.94L4.25 13.315L5.5 13.94L6.75 13.315L8 13.94L9.25 13.315L10.5 13.94V1.44L9.25 2.065L8 1.44L6.75 2.065L5.5 1.44L4.25 2.065L3 1.44L1.75 2.065L0.5 1.44Z"
              stroke="#858D9D" stroke-width="0.9375" stroke-linecap="round" stroke-linejoin="round" />
          </svg><span class="s2-strong">Lorem:</span>
          <span class="s2-yellow">Lorem</span>
          <span class="s2-green">“Ipsum”</span>
          <span class="s2-green">{{ hoveredNode.metadata?.highlightB }}</span>
          <span class="s2-strong">Loremipsum Loremipsum</span>
        </div>
        <div class="s2-pills-row first">
          <span *ngFor="let p of hoveredNode.metadata?.pills1" class="s2-pill purple">{{p}}</span>
          <span class="s2-strong">Loremipsum</span>
          <span *ngFor="let p of hoveredNode.metadata?.pills2" class="s2-pill purple">{{p}}</span>
        </div>
        <div class="s2-log second">
          <svg class="doc-icon small" width="11" height="15" viewBox="0 0 11 15" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path
              d="M6.75 5.19H3M8 7.69H3M6.125 10.19H3M0.5 1.44V13.94L1.75 13.315L3 13.94L4.25 13.315L5.5 13.94L6.75 13.315L8 13.94L9.25 13.315L10.5 13.94V1.44L9.25 2.065L8 1.44L6.75 2.065L5.5 1.44L4.25 2.065L3 1.44L1.75 2.065L0.5 1.44Z"
              stroke="#858D9D" stroke-width="0.9375" stroke-linecap="round" stroke-linejoin="round" />
          </svg><span class="s2-strong">Lorem:</span>
          <span class="s2-yellow">Lorem</span>
          <span class="s2-green">“Ipsum”</span>
          <span class="s2-strong">Loremipsum Loremipsum</span>
        </div>
        <div class="s2-pills-row second">
          <span *ngFor="let p of hoveredNode.metadata?.altPills" class="s2-pill purple">{{p}}</span>
          <span class="s2-code-pill" *ngIf="hoveredNode.metadata?.code">{{ hoveredNode.metadata?.code }}</span>
        </div>
      </div>

      <!-- 4. Endpoint1 variant (simplified design matching attached) -->
      <div *ngSwitchCase="'endpoint1'" class="popover popover-endpoint-simple">
        <div class="endpoint-simple-header">
          <img src="assets/icons/status/unprotected-bar.svg" class="endpoint-simple-icon" alt="endpoint" />
          <div class="endpoint-simple-text">
            <div class="endpoint-simple-label">{{ hoveredNode.label }}</div>
            <div class="endpoint-simple-ip">{{ hoveredNode.metadata?.ip }}</div>
          </div>
        </div>
        <div class="log-line"><svg class="doc-icon" width="11" height="15" viewBox="0 0 11 15" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path
              d="M6.75 5.19H3M8 7.69H3M6.125 10.19H3M0.5 1.44V13.94L1.75 13.315L3 13.94L4.25 13.315L5.5 13.94L6.75 13.315L8 13.94L9.25 13.315L10.5 13.94V1.44L9.25 2.065L8 1.44L6.75 2.065L5.5 1.44L4.25 2.065L3 1.44L1.75 2.065L0.5 1.44Z"
              stroke="#858D9D" stroke-width="0.9375" stroke-linecap="round" stroke-linejoin="round" />
          </svg><span class="label-strong">Lorem:</span> <span class="highlight-yellow s2-yellow">Lorem “Ipsum"</span></div>
        <div class="second-line"><span class="label-strong">Loremipsum</span> <span class="pill pill-blue">{{
            hoveredNode.metadata?.code }}</span></div>
      </div>

      <!-- 5. Endpoint2 variant (simplified design matching attached) -->
      <div *ngSwitchCase="'endpoint2'" class="popover popover-endpoint-simple">
        <div class="endpoint-simple-header">
          <img src="assets/icons/status/unprotected-bar.svg" class="endpoint-simple-icon" alt="endpoint" />
          <div class="endpoint-simple-text">
            <div class="endpoint-simple-label">{{ hoveredNode.label }}</div>
            <div class="endpoint-simple-ip">{{ hoveredNode.metadata?.ip }}</div>
          </div>
        </div>
        <div class="log-line"><svg class="doc-icon" width="11" height="15" viewBox="0 0 11 15" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path
              d="M6.75 5.19H3M8 7.69H3M6.125 10.19H3M0.5 1.44V13.94L1.75 13.315L3 13.94L4.25 13.315L5.5 13.94L6.75 13.315L8 13.94L9.25 13.315L10.5 13.94V1.44L9.25 2.065L8 1.44L6.75 2.065L5.5 1.44L4.25 2.065L3 1.44L1.75 2.065L0.5 1.44Z"
              stroke="#858D9D" stroke-width="0.9375" stroke-linecap="round" stroke-linejoin="round" />
          </svg><span class="label-strong">Lorem:</span> <span class="highlight-yellow s2-yellow">Lorem “Ipsum"</span></div>
        <div class="second-line"><span class="label-strong">Loremipsum</span> <span class="pill pill-blue">{{
            hoveredNode.metadata?.code }}</span></div>
      </div>
    </ng-container>
  </div>
</div>
